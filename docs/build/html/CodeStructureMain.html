

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>The Stay in Novaland &mdash; NovalandCorruptionGuide 2025 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=95c83b7e" />

  
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=cb975c41"></script>
      <script src="_static/doctools.js?v=9bcbadda"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="_static/design-tabs.js?v=f930bc37"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="The Election in Novaland" href="CodeStructureElection.html" />
    <link rel="prev" title="The Introduction App" href="CodeStructureIntro.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            NovalandCorruptionGuide
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="Novaland2Layout.html">The fictional country of Novaland</a></li>
<li class="toctree-l1"><a class="reference internal" href="ProjectStructure.html">Structure of the oTree project</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="CodeStructure.html">Functionality of the project code</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="CodeStructureGlobalFiles.html">Project-wide files</a></li>
<li class="toctree-l2"><a class="reference internal" href="CodeStructureIntro.html">The Introduction App</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">The Stay in Novaland</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#basic-functionality">Basic functionality</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#global-settings">Global settings</a></li>
<li class="toctree-l4"><a class="reference internal" href="#random-assignment-to-treatments-and-order-of-vignettes">Random assignment to treatments and order of vignettes</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#the-pages-of-the-main-app">The pages of the main app</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#the-introduction-to-novaland">1. The introduction to Novaland</a></li>
<li class="toctree-l4"><a class="reference internal" href="#structuring-the-stay-in-novaland">2. Structuring the stay in Novaland</a></li>
<li class="toctree-l4"><a class="reference internal" href="#the-smokescreen-pages">3. The smokescreen pages</a></li>
<li class="toctree-l4"><a class="reference internal" href="#the-news-quiz-pages">4. The news quiz pages</a></li>
<li class="toctree-l4"><a class="reference internal" href="#the-vignette-pages">5. The vignette pages</a></li>
<li class="toctree-l4"><a class="reference internal" href="#the-pollster-pages">6. The pollster pages</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#additional-code-for-extended-background-functionality">Additional code for extended background functionality</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="CodeStructureElection.html">The Election in Novaland</a></li>
<li class="toctree-l2"><a class="reference internal" href="CodeStructurePost.html">The Post-Experimental Questionnaire</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="Deployment.html">Deploying the oTree project</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">NovalandCorruptionGuide</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="CodeStructure.html">Functionality of the project code</a></li>
      <li class="breadcrumb-item active">The Stay in Novaland</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/CodeStructureMain.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="the-stay-in-novaland">
<h1>The Stay in Novaland<a class="headerlink" href="#the-stay-in-novaland" title="Link to this heading"></a></h1>
<p>The central part of this oTree project is the <code class="code docutils literal notranslate"><span class="pre">main</span></code> app. This app contains the part of the project which revolve around participants’ stay in Novaland. It begins with some pages that provide information about Novaland and then the virtual stay in this fictional country. Thus, the main app contains the vignettes and experimental treatments that are presented in the paper. Please note that we also simulated the national election of Novaland, in which participants could vote for one of two parties. This election is not included in this app, but is instead implemented in the <code class="code docutils literal notranslate"><span class="pre">election</span></code> app.</p>
<section id="basic-functionality">
<h2>Basic functionality<a class="headerlink" href="#basic-functionality" title="Link to this heading"></a></h2>
<section id="global-settings">
<h3>Global settings<a class="headerlink" href="#global-settings" title="Link to this heading"></a></h3>
<p>The global settings of the project are defined in the <code class="code docutils literal notranslate"><span class="pre">C</span></code> class, which contains constant variables that define the fundamental functionality and variables of the app.</p>
<details class="sd-sphinx-override sd-dropdown sd-card sd-mb-3">
<summary class="sd-summary-title sd-card-header">
<span class="sd-summary-icon"><svg version="1.1" width="1.0em" height="1.0em" class="sd-octicon sd-octicon-terminal" viewBox="0 0 16 16" aria-hidden="true"><path d="M0 2.75C0 1.784.784 1 1.75 1h12.5c.966 0 1.75.784 1.75 1.75v10.5A1.75 1.75 0 0 1 14.25 15H1.75A1.75 1.75 0 0 1 0 13.25Zm1.75-.25a.25.25 0 0 0-.25.25v10.5c0 .138.112.25.25.25h12.5a.25.25 0 0 0 .25-.25V2.75a.25.25 0 0 0-.25-.25ZM7.25 8a.749.749 0 0 1-.22.53l-2.25 2.25a.749.749 0 0 1-1.275-.326.749.749 0 0 1 .215-.734L5.44 8 3.72 6.28a.749.749 0 0 1 .326-1.275.749.749 0 0 1 .734.215l2.25 2.25c.141.14.22.331.22.53Zm1.5 1.5h3a.75.75 0 0 1 0 1.5h-3a.75.75 0 0 1 0-1.5Z"></path></svg></span><span class="sd-summary-text">Main App Global Settings</span><span class="sd-summary-state-marker sd-summary-chevron-right"><svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-right" viewBox="0 0 24 24" aria-hidden="true"><path d="M8.72 18.78a.75.75 0 0 1 0-1.06L14.44 12 8.72 6.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018l6.25 6.25a.75.75 0 0 1 0 1.06l-6.25 6.25a.75.75 0 0 1-1.06 0Z"></path></svg></span></summary><div class="sd-summary-content sd-card-body docutils">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">C</span><span class="p">(</span><span class="n">BaseConstants</span><span class="p">):</span>
    <span class="c1"># read the file containing the vignette questionnaire</span>
    <span class="n">file_path</span> <span class="o">=</span> <span class="s1">&#39;data/vignette_q.yaml&#39;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">yaml_file</span><span class="p">:</span>
        <span class="n">yaml_template</span> <span class="o">=</span> <span class="n">yaml_file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="c1"># read the file containing the text for the corrupt endings</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;data/corrupt_endings.yaml&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="n">CORRUPT_ENDINGS</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>

    <span class="n">NAME_IN_URL</span> <span class="o">=</span> <span class="s1">&#39;main&#39;</span> <span class="c1"># displayed name for participants in URL</span>
    <span class="n">PLAYERS_PER_GROUP</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># no interactions between participants</span>
    <span class="n">AVERAGE_NOVA_INCOME</span> <span class="o">=</span> <span class="mi">3000</span> <span class="c1"># average income in Novaland</span>
    <span class="n">SMOKESCREEN_ROUNDS</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="p">]</span> <span class="c1"># app rounds that contain smokescreens</span>
    <span class="n">VIGNETTE_ROUNDS</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">]</span> <span class="c1"># app rounds that contain vignettes</span>
    <span class="n">BRIBE_THRESHOLD</span> <span class="o">=</span> <span class="mi">300</span> <span class="c1"># not used in this study</span>

    <span class="n">vignettes</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;doctor&#39;</span><span class="p">,</span> <span class="s1">&#39;handyman&#39;</span><span class="p">,</span> <span class="s1">&#39;kindergarten&#39;</span><span class="p">,</span> <span class="s1">&#39;passport&#39;</span><span class="p">]</span>  <span class="c1"># names of the vignettes</span>
    <span class="n">POS</span> <span class="o">=</span> <span class="s2">&quot;pos&quot;</span> <span class="c1"># Represents a positive outcome</span>
    <span class="n">NEG</span> <span class="o">=</span> <span class="s2">&quot;neg&quot;</span> <span class="c1"># Represents a negative outcome</span>
    <span class="n">CORR</span> <span class="o">=</span> <span class="s2">&quot;corr&quot;</span>  <span class="c1"># Represents a corrupt outcome</span>

    <span class="c1"># Define the outcomes combinations to which participants were randomly assigned</span>
    <span class="n">outcomes_combinations_collection</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">[</span><span class="n">POS</span><span class="p">,</span> <span class="n">POS</span><span class="p">,</span> <span class="n">POS</span><span class="p">,</span> <span class="n">POS</span><span class="p">],</span>
        <span class="p">[</span><span class="n">POS</span><span class="p">,</span> <span class="n">POS</span><span class="p">,</span> <span class="n">POS</span><span class="p">,</span> <span class="n">NEG</span><span class="p">],</span>
        <span class="p">[</span><span class="n">POS</span><span class="p">,</span> <span class="n">POS</span><span class="p">,</span> <span class="n">POS</span><span class="p">,</span> <span class="n">CORR</span><span class="p">],</span>
        <span class="p">[</span><span class="n">POS</span><span class="p">,</span> <span class="n">NEG</span><span class="p">,</span> <span class="n">NEG</span><span class="p">,</span> <span class="n">NEG</span><span class="p">],</span>
        <span class="p">[</span><span class="n">POS</span><span class="p">,</span> <span class="n">CORR</span><span class="p">,</span> <span class="n">CORR</span><span class="p">,</span> <span class="n">CORR</span><span class="p">],</span>
        <span class="p">[</span><span class="n">POS</span><span class="p">,</span> <span class="n">POS</span><span class="p">,</span> <span class="n">NEG</span><span class="p">,</span> <span class="n">CORR</span><span class="p">],</span>
        <span class="p">[</span><span class="n">POS</span><span class="p">,</span> <span class="n">POS</span><span class="p">,</span> <span class="n">NEG</span><span class="p">,</span> <span class="n">CORR</span><span class="p">]</span>
    <span class="p">]</span>

    <span class="n">smokescreens</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;pets&#39;</span><span class="p">,</span> <span class="s1">&#39;restaurant&#39;</span><span class="p">]</span>  <span class="c1"># names of the smokescreens</span>

    <span class="c1"># Error handling, used in development</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">smokescreens</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">SMOKESCREEN_ROUNDS</span><span class="p">),</span> <span class="s2">&quot;Number of smokescreens and smokescreen rounds must be equal&quot;</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">vignettes</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">outcomes_combinations_collection</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="s2">&quot;Number of vignettes and outcomes must be equal&quot;</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">vignettes</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">VIGNETTE_ROUNDS</span><span class="p">),</span> <span class="s2">&quot;Number of vignettes and vignette rounds must be equal&quot;</span>

    <span class="c1"># Define the service levels for the vignettes</span>
    <span class="n">service_levels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">,</span> <span class="s1">&#39;corr&#39;</span><span class="p">,</span> <span class="s1">&#39;neg&#39;</span><span class="p">]</span>

    <span class="c1"># Define the number of rounds for later referencing</span>
    <span class="n">NUM_ROUNDS</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">vignettes</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">smokescreens</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="c1"># Define the days for the web page headers</span>
    <span class="n">NUM_DAYS</span> <span class="o">=</span> <span class="n">NUM_ROUNDS</span> <span class="o">+</span> <span class="mi">2</span>
    <span class="n">scenario_headers</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Samstag&quot;</span><span class="p">,</span> <span class="s2">&quot;Sonntag&quot;</span><span class="p">,</span> <span class="s2">&quot;Montag&quot;</span><span class="p">,</span> <span class="s2">&quot;Dienstag&quot;</span><span class="p">,</span> <span class="s2">&quot;Mittwoch&quot;</span><span class="p">,</span> <span class="s2">&quot;Donnerstag&quot;</span><span class="p">,</span> <span class="s2">&quot;Freitag&quot;</span><span class="p">]</span>

    <span class="n">ENDOWMENT</span> <span class="o">=</span> <span class="n">cu</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span> <span class="c1"># not used in this study</span>
</pre></div>
</div>
</div>
</details></section>
<section id="random-assignment-to-treatments-and-order-of-vignettes">
<h3>Random assignment to treatments and order of vignettes<a class="headerlink" href="#random-assignment-to-treatments-and-order-of-vignettes" title="Link to this heading"></a></h3>
<p>The logic that the main app follows is a bit more complex than the other apps. Most importantly, the main app consists of numerous rounds. The issue here is that in oTree, the variables stored in the <code class="code docutils literal notranslate"><span class="pre">Player</span></code> object are reset at the beginning of each round.</p>
<p>This means that if we want to define how the app behaves across the entirety of this app, we need to store them in the <code class="code docutils literal notranslate"><span class="pre">Participant</span></code> object. This is done in the <code class="code docutils literal notranslate"><span class="pre">creating_session</span></code> function, which is called once for each participant when they first enter the app (after completing the intro questionnaire). In this function, we create a random order of vignettes, outcomes of the vignettes, and smokescreens for each participant. This is done by creating a list for each possible orders of those, and then randomly assigning one entry from that list to each participant.</p>
<p>XXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</p>
<details class="sd-sphinx-override sd-dropdown sd-card sd-mb-3">
<summary class="sd-summary-title sd-card-header">
<span class="sd-summary-icon"><svg version="1.1" width="1.0em" height="1.0em" class="sd-octicon sd-octicon-terminal" viewBox="0 0 16 16" aria-hidden="true"><path d="M0 2.75C0 1.784.784 1 1.75 1h12.5c.966 0 1.75.784 1.75 1.75v10.5A1.75 1.75 0 0 1 14.25 15H1.75A1.75 1.75 0 0 1 0 13.25Zm1.75-.25a.25.25 0 0 0-.25.25v10.5c0 .138.112.25.25.25h12.5a.25.25 0 0 0 .25-.25V2.75a.25.25 0 0 0-.25-.25ZM7.25 8a.749.749 0 0 1-.22.53l-2.25 2.25a.749.749 0 0 1-1.275-.326.749.749 0 0 1 .215-.734L5.44 8 3.72 6.28a.749.749 0 0 1 .326-1.275.749.749 0 0 1 .734.215l2.25 2.25c.141.14.22.331.22.53Zm1.5 1.5h3a.75.75 0 0 1 0 1.5h-3a.75.75 0 0 1 0-1.5Z"></path></svg></span><span class="sd-summary-text">Randomization in the main app</span><span class="sd-summary-state-marker sd-summary-chevron-right"><svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-right" viewBox="0 0 24 24" aria-hidden="true"><path d="M8.72 18.78a.75.75 0 0 1 0-1.06L14.44 12 8.72 6.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018l6.25 6.25a.75.75 0 0 1 0 1.06l-6.25 6.25a.75.75 0 0 1-1.06 0Z"></path></svg></span></summary><div class="sd-summary-content sd-card-body docutils">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">creating_session</span><span class="p">(</span><span class="n">subsession</span><span class="p">:</span> <span class="n">Subsession</span><span class="p">):</span>
<span class="c1"># create random order of vignettes, smokescreens, and dependent variables once at the beginning of the session</span>
<span class="k">if</span> <span class="n">subsession</span><span class="o">.</span><span class="n">round_number</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
    <span class="c1"># calculate execution time</span>
    <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">cycle_collection</span> <span class="o">=</span> <span class="n">cycle</span><span class="p">(</span><span class="n">C</span><span class="o">.</span><span class="n">outcomes_combinations_collection</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">subsession</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_participants</span><span class="p">():</span>
        <span class="c1"># randomize the order of vignettes</span>
        <span class="n">vignettes</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">vignettes</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">vignettes</span><span class="p">)</span>
        <span class="n">p</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;vignette_order&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">vignettes</span>

        <span class="c1"># choose outcomes combination</span>
        <span class="c1"># outcomes_collection = C.outcomes_combinations_collection.copy()</span>
        <span class="n">outcomes_collection</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">cycle_collection</span><span class="p">)</span>

        <span class="c1"># randomize the order of outcomes</span>
        <span class="n">outcomes</span> <span class="o">=</span> <span class="n">outcomes_collection</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">outcomes</span><span class="p">)</span>

        <span class="c1"># create outcomes variable for uniform outcomes treatment sessions</span>
        <span class="n">treatment</span> <span class="o">=</span> <span class="n">subsession</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;treatment&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">subsession</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;treatment&#39;</span><span class="p">):</span>
            <span class="n">outcomes</span> <span class="o">=</span> <span class="p">[</span><span class="n">treatment</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">outcomes</span><span class="p">)</span>

        <span class="c1"># create participant variables for vignettes and outcomes</span>
        <span class="n">p</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;outcomes_collection&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">outcomes_collection</span>
        <span class="n">p</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;vignette_outcomes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">outcomes</span>
        <span class="n">p</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;vignettes_with_outcomes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">vignettes</span><span class="p">,</span> <span class="n">outcomes</span><span class="p">))</span>

        <span class="c1"># randomize the order of smokescreens</span>
        <span class="n">smokescreens</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">smokescreens</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">smokescreens</span><span class="p">)</span>
        <span class="n">p</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;smokescreen_order&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">smokescreens</span>

        <span class="c1"># create variable for quiz page</span>
        <span class="n">p</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;quiz_page&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;quiz_page&#39;</span><span class="p">]</span>

        <span class="c1"># create timeline over the 9 days in Novaland at participant level</span>
        <span class="n">p</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;timeline&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;smokescreen_order&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span> <span class="o">+</span>  <span class="c1"># note that the quiz page comes after the first smokescreen</span>
                <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;quiz_page&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span> <span class="o">+</span>  <span class="c1"># quiz page</span>
                <span class="n">p</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;vignette_order&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span>  <span class="c1"># the first two vignettes</span>
                <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;smokescreen_order&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]]</span> <span class="o">+</span>  <span class="c1"># the second smokescreen</span>
                <span class="n">p</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;vignette_order&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span>  <span class="c1"># the last two vignettes</span>
        <span class="p">)</span>

        <span class="c1"># create variable on corruption info treatment</span>
        <span class="n">corruption_info</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="n">p</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;corruption_info&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">corruption_info</span>

        <span class="c1"># create variable for randomized order of pollster questions</span>
        <span class="n">pollster_questions</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;pollster_question_gov_trust&quot;</span><span class="p">,</span> <span class="s2">&quot;pollster_question_taxes_welfare&quot;</span><span class="p">,</span>
                              <span class="s2">&quot;pollster_question_perc_corruption&quot;</span><span class="p">]</span>
        <span class="n">pollster_order</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">pollster_questions</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="n">p</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;pollster_order&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pollster_order</span>
    <span class="n">end_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;PARTIICPANT BLOCK Execution time: </span><span class="si">{</span><span class="n">end_time</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">start_time</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="c1"># access the order of vignettes, smokescreens, and dependent variables for each player (per round)</span>
<span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">subsession</span><span class="o">.</span><span class="n">get_players</span><span class="p">():</span>
    <span class="n">participant</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">participant</span>
    <span class="n">p</span><span class="o">.</span><span class="n">dump_collection</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">participant</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;outcomes_collection&#39;</span><span class="p">])</span>
    <span class="n">p</span><span class="o">.</span><span class="n">scenario_order</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">participant</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;timeline&#39;</span><span class="p">])</span>
    <span class="n">p</span><span class="o">.</span><span class="n">current_scenario</span> <span class="o">=</span> <span class="n">participant</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;timeline&#39;</span><span class="p">][</span><span class="n">p</span><span class="o">.</span><span class="n">round_number</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">current_scenario</span> <span class="ow">in</span> <span class="n">C</span><span class="o">.</span><span class="n">vignettes</span><span class="p">:</span>
        <span class="n">p</span><span class="o">.</span><span class="n">vignette_order</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">participant</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;vignette_order&#39;</span><span class="p">])</span>
        <span class="n">p</span><span class="o">.</span><span class="n">service_level</span> <span class="o">=</span> <span class="n">participant</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;vignettes_with_outcomes&#39;</span><span class="p">][</span><span class="n">p</span><span class="o">.</span><span class="n">current_scenario</span><span class="p">]</span>
        <span class="c1"># p.num_pos_vign_before = [p.field_maybe_none(&#39;service_level&#39;) for p in p.in_previous_rounds()].count(&#39;pos&#39;)</span>
        <span class="c1"># p.num_neg_vign_before = [p.field_maybe_none(&#39;service_level&#39;) for p in p.in_previous_rounds()].count(&#39;neg&#39;)</span>
        <span class="c1"># p.num_corr_vign_before = [p.field_maybe_none(&#39;service_level&#39;) for p in p.in_previous_rounds()].count(&#39;corr&#39;)</span>
    <span class="n">p</span><span class="o">.</span><span class="n">pollster_order</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">participant</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;pollster_order&#39;</span><span class="p">])</span>
<span class="n">end_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;PLAYER BLOCK Execution time: </span><span class="si">{</span><span class="n">end_time</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">start_time</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details></section>
</section>
<section id="the-pages-of-the-main-app">
<h2>The pages of the main app<a class="headerlink" href="#the-pages-of-the-main-app" title="Link to this heading"></a></h2>
<p>Here, the pages of the main questionnaire are described in the order in which they appear in the questionnaire. Participants lived through nine days in Novaland. The main app contains eight of those, while the last day is the voting day, which is implemented in the <code class="code docutils literal notranslate"><span class="pre">election</span></code> app.</p>
<p>The main app is structured in <strong>two distinct parts</strong>: First participants received information about Novaland and are asked some questions about this. The then began their actual stay in the country, where they were presented with various situations and are asked to answer questions about them.</p>
<section id="the-introduction-to-novaland">
<h3>1. The introduction to Novaland<a class="headerlink" href="#the-introduction-to-novaland" title="Link to this heading"></a></h3>
<p>The introductory part of the main app consists of four <strong>NovalandIntro</strong> pages, on which participants are informed about their stay in Novaland as citizens of the fictional country and about some characteristics of the country itself. The text that was included on these pages can be found in the <code class="code docutils literal notranslate"><span class="pre">main/instructions/</span></code> folder. There is one file for each of these four information pages.</p>
<p>On the fourth NovalandIntro page, the first experimental treatment takes place. Participants were randomly assigned to two groups: the first group is informed about the social norm of bribing in Novaland (6 out of 10 citizens of Novaland are willing to pay a bribe for a service). Participants in the second group do not receive any information. The variable that determines if participants received this information is called <code class="code docutils literal notranslate"><span class="pre">corruption_info</span></code> and is stored in the <code class="code docutils literal notranslate"><span class="pre">Participant</span></code> object. The variable is set to 1 if participants received the information and 0 if they did not. This variable is used to determine which text is displayed on the page and is passed to the HTML template (<code class="code docutils literal notranslate"><span class="pre">main/instructions/instructions_4.html</span></code>). There, the conditional statement of showing the social norm information works with this variable: <code class="code docutils literal notranslate"><span class="pre">{{</span> <span class="pre">if</span> <span class="pre">participant.vars.corruption_info</span> <span class="pre">==</span> <span class="pre">1</span> <span class="pre">}}</span></code>.</p>
<p>The next page is the <strong>Comprehension</strong> page. On this page, participants had to answer three comprehension questions correctly in order to continue with the questionnaire. The questions are about the information that was provided on the previous pages. The questions are defined in the player models <code class="code docutils literal notranslate"><span class="pre">comprehension_citizen</span></code>, <code class="code docutils literal notranslate"><span class="pre">comprehension_income</span></code>, and <code class="code docutils literal notranslate"><span class="pre">comprehension_financing</span></code>. These three questions are defined as <code class="code docutils literal notranslate"><span class="pre">form_fields</span></code> in the <code class="code docutils literal notranslate"><span class="pre">Comprehension</span></code> page class and called by the page’s HTML template using <code class="code docutils literal notranslate"><span class="pre">{{formfields}}</span></code>.</p>
<p>We gave participants the possibility to receive the respective pieces of information again using an “instructions” button that was embedded on the page. For this, we used the <code class="code docutils literal notranslate"><span class="pre">live_method</span></code> in the init file and the following code in the HTML template to dynamically animate the window with the text from the <code class="code docutils literal notranslate"><span class="pre">main/instructions/</span></code> HTML files that were also used to display the information on the previous pages. The code runs as soon as participants click on the instructions button:</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="linenos">2</span><span class="w">    </span><span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">ready</span><span class="p">(</span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">3</span><span class="w">        </span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#instruction_button&#39;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">4</span><span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">debug</span><span class="p">(</span><span class="s1">&#39;button clicked&#39;</span><span class="p">);</span>
<span class="linenos">5</span><span class="w">            </span><span class="nx">liveSend</span><span class="p">(</span><span class="s1">&#39;button_clicked&#39;</span><span class="p">);</span>
<span class="linenos">6</span><span class="w">        </span><span class="p">});</span>
<span class="linenos">7</span><span class="w">    </span><span class="p">});</span>
<span class="linenos">8</span><span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>Participants had two attempts to answer all comprehension questions correctly. If they tried to submit the page with incorrect answers, the <code class="code docutils literal notranslate"><span class="pre">error_counter</span></code> increases and an error message appears. The page is then reloaded. They are then informed that they have one attempt left. If they submit the page again with incorrect answers for the second time, they will be filtered out. We also set a timeout counter on this page to prevent participants from spending too much time on it. If they exceed the time limit, they were also filtered out. The timeout counter is set to five minutes, which is more than enough time to answer the questions.</p>
<p>If participants failed to answer the comprehension questions correctly two times, or if they exceeded the time limit, they were next redirected to the <strong>TerminationPage</strong>. This page is not shown to participants, but is only used for background functionality. Only participants who fulfill one of these two criteria are redirected to this page, the other ones skip it, as defined in</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="nd">@staticmethod</span>
<span class="linenos">2</span><span class="k">def</span><span class="w"> </span><span class="nf">is_displayed</span><span class="p">(</span><span class="n">player</span><span class="p">:</span> <span class="n">Player</span><span class="p">):</span>
<span class="linenos">3</span>    <span class="k">return</span> <span class="n">player</span><span class="o">.</span><span class="n">error_counter</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">player</span><span class="o">.</span><span class="n">comprehension_timeouted</span>
</pre></div>
</div>
<p>As soon as participants reached this page, they were directly redirected using a link provided by the panel provider, defined in <code class="code docutils literal notranslate"><span class="pre">TERMINATION_LINK</span></code>. Participants were then informed that they failed to comply with the requirements of the study and were thus filtered out.</p>
<p>Those participants who answered all three comprehension questions correctly, reached the last page of the introduction to Novaland. On the <strong>IntroVignette</strong> page, participants were informed that they will encounter several situations on the next pages, that they are a citizen of Novaland in this context and that they should answer the questions as themselves.</p>
</section>
<section id="structuring-the-stay-in-novaland">
<h3>2. Structuring the stay in Novaland<a class="headerlink" href="#structuring-the-stay-in-novaland" title="Link to this heading"></a></h3>
<p>After receiving all this information and passing the comprehension checks, participants began their stay in Novaland. For an overview of the fictional stay, please refer to the <a class="reference internal" href="Novaland2Layout.html#flowchart"><span class="std std-ref">flowchart of the Novaland stay</span></a>.</p>
<p>Before we discuss how the experience on each page was created, we first have to take a step back and talk about the underlying logic of the main app. While participants experience their fictional stay as one continuous trip, the app does not run only once. Instead, oTree runs the <code class="code docutils literal notranslate"><span class="pre">main</span></code> app seven rounds. The flow of the Novaland stay is created by defining for each page in which round it is displayed.
The different rounds of the main app contain the following pages:</p>
<ol class="arabic simple">
<li><p>Round: NovalandIntro Pages, Comprehension Page, IntroVignette Page, First Smokescreen Page</p></li>
<li><p>Round: Quiz Page, Quiz Results Page</p></li>
<li><p>Round: First Vignette Page, First Vignette Results Page</p></li>
<li><p>Round: Second Vignette Page, Second Vignette Results Page</p></li>
<li><p>Round: Second Smokescreen Page</p></li>
<li><p>Round: Third Vignette Page, Third Vignette Results Page</p></li>
<li><p>Round: Fourth Vignette Page, Fourth Vignette Results Page, Pollster Pages, Pollster Results Page</p></li>
</ol>
<p><strong>Order of the smokescreens and vignettes</strong></p>
<p>This order is defined in the <code class="code docutils literal notranslate"><span class="pre">timeline</span></code> variable in <code class="code docutils literal notranslate"><span class="pre">creating_session</span></code> function. By using the list objects for the order of the smokescreens and vignettes, we can define the order in which they are displayed to the participants. Each entry of the list contains a string that identifies the corresponding vignette or smokescreen scenario. We will discuss the functionality of these pages in more detail below.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="n">p</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;timeline&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
<span class="linenos">2</span>        <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;smokescreen_order&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span> <span class="o">+</span>  <span class="c1"># note that the quiz page comes after the first smokescreen</span>
<span class="linenos">3</span>        <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;quiz_page&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span> <span class="o">+</span>  <span class="c1"># quiz page</span>
<span class="linenos">4</span>        <span class="n">p</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;vignette_order&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span>  <span class="c1"># the first two vignettes</span>
<span class="linenos">5</span>        <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;smokescreen_order&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]]</span> <span class="o">+</span>  <span class="c1"># the second smokescreen</span>
<span class="linenos">6</span>        <span class="n">p</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;vignette_order&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span>  <span class="c1"># the last two vignettes</span>
<span class="linenos">7</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="the-smokescreen-pages">
<h3>3. The smokescreen pages<a class="headerlink" href="#the-smokescreen-pages" title="Link to this heading"></a></h3>
<p>The smokescreen pages are designed to immerse participants more into the virtual country and to reduce demand effects by distracting participants from the main purpose of the questionnaire,. They are presented as everyday situations that participants might encounter in Novaland. The smokescreens are displayed in the first and fifth rounds of the main app. The first smokescreen is displayed after the introduction to Novaland, while the second smokescreen is displayed after the second vignette.</p>
<p>The scenarios of the smokescreens contain arbitrary situations that are not directly related to the main purpose of the questionnaire. One smokescreen is about adopting a pet, while the other smokescreen is about visiting a restaurant. The order of these two scenarios was randomized for each participant.</p>
<p>Let’s have a detailed look into the code of the smokescreen pages - how they are created, how they are randomized and how they are displayed to the participants.</p>
<p>In the <code class="code docutils literal notranslate"><span class="pre">C</span></code> section, the rounds in which the smokescreens are displayed are defined in <code class="code docutils literal notranslate"><span class="pre">SMOKESCREEN_ROUNDS</span> <span class="pre">=</span> <span class="pre">[1,</span> <span class="pre">5]</span></code>.
The smokescreens are then defined in the <code class="code docutils literal notranslate"><span class="pre">smokescreens</span></code> variable as a list of strings: <code class="code docutils literal notranslate"><span class="pre">smokescreens</span> <span class="pre">=</span> <span class="pre">['pets',</span> <span class="pre">'restaurant']</span></code>. The first smokescreen is called “pets” and the second smokescreen is called “restaurant”.
In the <code class="code docutils literal notranslate"><span class="pre">creating_session</span></code> function, the order of the smokescreens is randomized for each participant. This is done by using the <code class="code docutils literal notranslate"><span class="pre">smokescreens</span></code> object and then shuffling it using the <code class="code docutils literal notranslate"><span class="pre">random.shuffle()</span></code> function. The randomized order is then stored in the <code class="code docutils literal notranslate"><span class="pre">Participant</span></code> object as <code class="code docutils literal notranslate"><span class="pre">p.vars['smokescreen_order']</span></code>.</p>
<p>The code for the smokescreen pages is implemented in the <code class="code docutils literal notranslate"><span class="pre">Smokescreen</span></code> page class:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="k">class</span><span class="w"> </span><span class="nc">Smokescreen</span><span class="p">(</span><span class="n">Page</span><span class="p">):</span>
<span class="linenos"> 2</span>    <span class="n">form_model</span> <span class="o">=</span> <span class="s1">&#39;player&#39;</span>
<span class="linenos"> 3</span>
<span class="linenos"> 4</span>    <span class="nd">@staticmethod</span>
<span class="linenos"> 5</span>    <span class="k">def</span><span class="w"> </span><span class="nf">is_displayed</span><span class="p">(</span><span class="n">player</span><span class="p">):</span>
<span class="linenos"> 6</span>        <span class="k">return</span> <span class="n">player</span><span class="o">.</span><span class="n">round_number</span> <span class="ow">in</span> <span class="n">C</span><span class="o">.</span><span class="n">SMOKESCREEN_ROUNDS</span>
<span class="linenos"> 7</span>
<span class="linenos"> 8</span>    <span class="k">def</span><span class="w"> </span><span class="nf">get_form_fields</span><span class="p">(</span><span class="n">player</span><span class="p">):</span>
<span class="linenos"> 9</span>        <span class="k">return</span> <span class="p">[</span><span class="n">player</span><span class="o">.</span><span class="n">current_scenario</span><span class="p">]</span>
<span class="linenos">10</span>
<span class="linenos">11</span>    <span class="nd">@staticmethod</span>
<span class="linenos">12</span>    <span class="k">def</span><span class="w"> </span><span class="nf">vars_for_template</span><span class="p">(</span><span class="n">player</span><span class="p">:</span> <span class="n">Player</span><span class="p">):</span>
<span class="linenos">13</span>        <span class="k">return</span> <span class="p">{</span>
<span class="linenos">14</span>            <span class="s1">&#39;smokescreen&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;main/smokescreens/</span><span class="si">{</span><span class="n">player</span><span class="o">.</span><span class="n">current_scenario</span><span class="si">}</span><span class="s1">.html&#39;</span><span class="p">,</span>
<span class="linenos">15</span>            <span class="s1">&#39;smokescreen_header&#39;</span><span class="p">:</span> <span class="n">C</span><span class="o">.</span><span class="n">scenario_headers</span><span class="p">[</span><span class="n">player</span><span class="o">.</span><span class="n">round_number</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
<p>The <code class="code docutils literal notranslate"><span class="pre">is_displayed</span></code> method is used to determine whether the page should be displayed to the participant. This is done by checking whether the current round number is in the list of smokescreen rounds defined in the <code class="code docutils literal notranslate"><span class="pre">C</span></code> class.</p>
<p>The <code class="code docutils literal notranslate"><span class="pre">get_form_fields</span></code> method is used to define the form fields that are displayed on the page. In this case, it returns the current scenario of the participant, which is stored in the <code class="code docutils literal notranslate"><span class="pre">current_scenario</span></code> variable. This variable is set in the <code class="code docutils literal notranslate"><span class="pre">creating_session</span></code> function and contains the name of the current smokescreen scenario for the participant. This dynamic variable function is used to ensure that the correct smokescreen scenario is displayed to the participant. It is required because there is only one HTML template for both smokescreens, which is dynamically filled with the content of the current smokescreen scenario.</p>
<p>The <code class="code docutils literal notranslate"><span class="pre">vars_for_template</span></code> method is used to pass variables to the HTML template. In this case, it passes the path to the HTML template of the current smokescreen scenario and the header for the smokescreen page. This is used because the HTML template for the smokescreen pages is the same for both smokescreens and the content is dynamically filled with the current smokescreen scenario.</p>
<p>The path to the HTML template is constructed using the <code class="code docutils literal notranslate"><span class="pre">main/smokescreens/</span></code> folder and the name of the current scenario, as this folder contains the two HTML files (<code class="code docutils literal notranslate"><span class="pre">pets.html</span></code> and <code class="code docutils literal notranslate"><span class="pre">restaurant.html</span></code>) that define the text of the smokescreen pages.
The header of the page is defined in the <code class="code docutils literal notranslate"><span class="pre">scenario_headers</span></code> variable in the <code class="code docutils literal notranslate"><span class="pre">C</span></code> class and contains the name of the day on which the smokescreen is displayed. This dynamic variable function is used to ensure that the correct header is displayed on the page, depending on the round number in which the smokescreen is displayed. It contains the number of the day in Novaland and the current day of the week.</p>
<p>The participants were asked to answer a question about the smokescreen scenario - either to adopt a pet or to choose the restaurant they want to visit. Again, we used a dynamic variable function to ensure that the correct question is displayed to the participant. The question object were defined in the <code class="code docutils literal notranslate"><span class="pre">Player</span></code> model as <code class="code docutils literal notranslate"><span class="pre">pets</span></code> and <code class="code docutils literal notranslate"><span class="pre">restaurant</span></code>, respectively. The question is then displayed in the HTML template using the <code class="code docutils literal notranslate"><span class="pre">{{</span> <span class="pre">formfields</span> <span class="pre">}}</span></code> variable, which is defined in the <code class="code docutils literal notranslate"><span class="pre">get_form_fields</span></code> method of the <code class="code docutils literal notranslate"><span class="pre">Smokescreen</span></code> page class.</p>
<p>With this setup, we ensure that the smokescreen pages are displayed correctly to the participants - at the correct time, and with the correct content according to the randomized order of the smokescreens.</p>
</section>
<section id="the-news-quiz-pages">
<h3>4. The news quiz pages<a class="headerlink" href="#the-news-quiz-pages" title="Link to this heading"></a></h3>
<p>The <strong>Quiz</strong> was used to both test participants’ attention, to check if they understood the information provided on the previous pages, and to distract them from the main purpose of the questionnaire by making this check an in-experience situation. The quiz was presented as a news quiz about Novaland, which participants had to answer correctly in order to continue with the questionnaire. The quiz was displayed in the second round of the main app, after the first smokescreen and before the first vignette.</p>
<p>This page is implemented in the <code class="code docutils literal notranslate"><span class="pre">Quiz</span></code> page class.. The quiz consists of two questions, which are defined as <code class="code docutils literal notranslate"><span class="pre">form_fields</span></code> in the page class. The questions are: First, <code class="code docutils literal notranslate"><span class="pre">quiz_event</span></code>, asking which public event is scheduled in the next days in Novaland.The correct answer was the national election. And second, <code class="code docutils literal notranslate"><span class="pre">quiz_income</span></code>, asking about the average income in Novaland. The correct answer being 3000 Nova Dollars.</p>
<p>Those participants who received the information about the social norm of bribing in Novaland on the previous pages were also asked a third question, <code class="code docutils literal notranslate"><span class="pre">quiz_corr</span></code>, asking how many citizens of Novaland were willing to pay a bribe for a service. The correct answer was 6 out of 10 citizens. This is done by using two pieces of code. In the <code class="code docutils literal notranslate"><span class="pre">get_form_fields</span></code> method, we check whether the participant received the information about the social norm of bribing in Novaland. If they did, we add the third question to the list of form fields that are displayed on the page. This is done by checking the <code class="code docutils literal notranslate"><span class="pre">corruption_info</span></code> variable in the <code class="code docutils literal notranslate"><span class="pre">Participant</span></code> object, which is set to 1 if participants received the information and 0 if they did not.
In the page’s HTML template, we then check whether the <code class="code docutils literal notranslate"><span class="pre">corruption_info</span></code> variable is set to 1. If it is, we display the third question. This is done using the conditional statement <code class="code docutils literal notranslate"><span class="pre">{{</span> <span class="pre">if</span> <span class="pre">corruption_info</span> <span class="pre">==</span> <span class="pre">1</span> <span class="pre">}}</span> <span class="pre">{{</span> <span class="pre">formfield</span> <span class="pre">player.quiz_corr</span> <span class="pre">}}</span></code>.</p>
<p>After participants submitted their answers, some calculations were automatically conducted by oTree to analyse the quiz results. Within the page class, the <code class="code docutils literal notranslate"><span class="pre">before_next_page</span></code> function is used to calculate the number of correct answers and whether the participant answered all questions correctly. This is done by comparing the participants’ answers with the correct answers defined in the <code class="code docutils literal notranslate"><span class="pre">quiz_correspondence</span></code> dictionary, which contains the correct answers for each question.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="k">def</span><span class="w"> </span><span class="nf">before_next_page</span><span class="p">(</span><span class="n">player</span><span class="p">,</span> <span class="n">timeout_happened</span><span class="p">):</span>
<span class="linenos">2</span>    <span class="n">fields</span> <span class="o">=</span> <span class="n">Quiz</span><span class="o">.</span><span class="n">get_form_fields</span><span class="p">(</span><span class="n">player</span><span class="p">)</span> <span class="c1"># get questions</span>
<span class="linenos">3</span>    <span class="n">correct_answers</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">quiz_correspondence</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">}</span> <span class="c1"># compare answers with correct answers defined in the quiz_correspondence dictionary</span>
<span class="linenos">4</span>    <span class="n">answers</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">player</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">}</span> <span class="c1"># get participants&#39; answers</span>
<span class="linenos">5</span>    <span class="n">are_answers_correct</span> <span class="o">=</span> <span class="p">[</span><span class="n">answers</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">==</span> <span class="n">correct_answers</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">]</span> <span class="c1"># check if answers are correct</span>
<span class="linenos">6</span>    <span class="n">player</span><span class="o">.</span><span class="n">quiz_correct_answers</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">are_answers_correct</span><span class="p">)</span> <span class="c1"># calculate number of correct answers</span>
<span class="linenos">7</span>    <span class="n">player</span><span class="o">.</span><span class="n">quiz_num_questions</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span> <span class="c1"># calculate number of questions</span>
<span class="linenos">8</span>    <span class="n">player</span><span class="o">.</span><span class="n">quiz_fully_correct</span> <span class="o">=</span> <span class="nb">all</span><span class="p">(</span><span class="n">are_answers_correct</span><span class="p">)</span> <span class="c1"># check if all answers are correct</span>
</pre></div>
</div>
<p>After the quiz page, participants saw the <strong>QuizResults</strong> page. On this page, they were informed about the correct answers to the quiz questions. Again, we used the <code class="code docutils literal notranslate"><span class="pre">corruption_info</span></code> variable to determine whether the third question was displayed. If it was, the correct answer to this question was also displayed on the page. After the participants submitted the page, they were redirected to the first vignette page.</p>
</section>
<section id="the-vignette-pages">
<h3>5. The vignette pages<a class="headerlink" href="#the-vignette-pages" title="Link to this heading"></a></h3>
</section>
<section id="the-pollster-pages">
<h3>6. The pollster pages<a class="headerlink" href="#the-pollster-pages" title="Link to this heading"></a></h3>
</section>
</section>
<section id="additional-code-for-extended-background-functionality">
<h2>Additional code for extended background functionality<a class="headerlink" href="#additional-code-for-extended-background-functionality" title="Link to this heading"></a></h2>
<p>In addition to the code described above, there are some additional code snippets that are used to implement the extended background functionality of the questionnaire. These snippets are not directly related to the main functionality of the questionnaire, but they are used to enhance the user experience and provide additional features.</p>
<p><strong>Progress bar</strong></p>
<p>At the top of the main app’s __init__.py file, the <code class="code docutils literal notranslate"><span class="pre">Page</span></code> class is defined. This is the parent class for all pages in the app. This means that the code that is defined within it is executed by all survey pages across the app.
This class is used to automatically retrieve the current page number and maximum page number of the questionnaire using the <code class="code docutils literal notranslate"><span class="pre">get_context_data</span></code> function. This function then calculates the progress percentage. The progress percentage is then passed to the HTML template, where it is displayed as a progress bar.</p>
<details class="sd-sphinx-override sd-dropdown sd-card sd-mb-3">
<summary class="sd-summary-title sd-card-header">
<span class="sd-summary-icon"><svg version="1.1" width="1.0em" height="1.0em" class="sd-octicon sd-octicon-terminal" viewBox="0 0 16 16" aria-hidden="true"><path d="M0 2.75C0 1.784.784 1 1.75 1h12.5c.966 0 1.75.784 1.75 1.75v10.5A1.75 1.75 0 0 1 14.25 15H1.75A1.75 1.75 0 0 1 0 13.25Zm1.75-.25a.25.25 0 0 0-.25.25v10.5c0 .138.112.25.25.25h12.5a.25.25 0 0 0 .25-.25V2.75a.25.25 0 0 0-.25-.25ZM7.25 8a.749.749 0 0 1-.22.53l-2.25 2.25a.749.749 0 0 1-1.275-.326.749.749 0 0 1 .215-.734L5.44 8 3.72 6.28a.749.749 0 0 1 .326-1.275.749.749 0 0 1 .734.215l2.25 2.25c.141.14.22.331.22.53Zm1.5 1.5h3a.75.75 0 0 1 0 1.5h-3a.75.75 0 0 1 0-1.5Z"></path></svg></span><span class="sd-summary-text">Progress bar calculations</span><span class="sd-summary-state-marker sd-summary-chevron-right"><svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-right" viewBox="0 0 24 24" aria-hidden="true"><path d="M8.72 18.78a.75.75 0 0 1 0-1.06L14.44 12 8.72 6.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018l6.25 6.25a.75.75 0 0 1 0 1.06l-6.25 6.25a.75.75 0 0 1-1.06 0Z"></path></svg></span></summary><div class="sd-summary-content sd-card-body docutils">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">Page</span><span class="p">(</span><span class="n">oTreePage</span><span class="p">):</span>
    <span class="n">instructions</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_context_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">context</span><span class="p">):</span>
        <span class="n">NUM_SURVEY_PAGES</span> <span class="o">=</span> <span class="mi">36</span>
        <span class="n">app_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__module__</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">page_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
        <span class="k">if</span> <span class="n">page_name</span> <span class="o">!=</span> <span class="s1">&#39;PostSurvey&#39;</span> <span class="ow">and</span> <span class="n">app_name</span> <span class="o">==</span> <span class="s1">&#39;post&#39;</span><span class="p">:</span>
            <span class="n">index_in_pages</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index_in_pages</span> <span class="o">+</span> <span class="n">NUM_SURVEY_PAGES</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">index_in_pages</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index_in_pages</span>
        <span class="n">r</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_context_data</span><span class="p">(</span><span class="o">**</span><span class="n">context</span><span class="p">)</span>

        <span class="k">if</span> <span class="s1">&#39;post&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;app_sequence&#39;</span><span class="p">):</span>
            <span class="n">max_pages</span> <span class="o">=</span> <span class="n">NUM_SURVEY_PAGES</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">participant</span><span class="o">.</span><span class="n">_max_page_index</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">max_pages</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">participant</span><span class="o">.</span><span class="n">_max_page_index</span>

        <span class="n">r</span><span class="p">[</span><span class="s1">&#39;maxpages&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">max_pages</span>
        <span class="n">r</span><span class="p">[</span><span class="s1">&#39;page_index&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index_in_pages</span>
        <span class="n">r</span><span class="p">[</span><span class="s1">&#39;progress&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">index_in_pages</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">max_pages</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">100</span><span class="p">)</span><span class="si">:</span><span class="s1">d</span><span class="si">}</span><span class="s1">&#39;</span>

        <span class="n">r</span><span class="p">[</span><span class="s1">&#39;instructions&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">instructions</span>
        <span class="k">return</span> <span class="n">r</span>
</pre></div>
</div>
</div>
</details><p><strong>Animating the status bar</strong> XXXXXXXXXXXXXXXXXXXXXXXX</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="CodeStructureIntro.html" class="btn btn-neutral float-left" title="The Introduction App" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="CodeStructureElection.html" class="btn btn-neutral float-right" title="The Election in Novaland" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, POLITSOLID Project Team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>